# Improving Temporal Antialiasing with Adaptive Ray Tracing

> Citation: Marrs A., Spjut J., Gruen H., Sathe R., McGuire M. (2019) Improving Temporal Antialiasing with Adaptive Ray Tracing. In: Haines E., Akenine-Möller T. (eds) Ray Tracing Gems. Apress, Berkeley, CA
> Available online: http://www.realtimerendering.com/raytracinggems/

## 摘要

本章讨论了一种实用的实时超级采样方法，该方法使用自适应的光线追踪扩展了常用的时间性抗锯齿技术。该算法可以满足商业渲染引擎的限制条件，去除了标准的时间性抗锯齿的模糊的残影现象，并且可以在每帧16ms的时间限制内实现相当于16倍超级采样的效果。

### 1 简介

可见表面的走样是计算机图形学最基础且最具有挑战性的问题之一。几乎所有渲染方法都以像素内的点对表明进行采样，因此当采样的点不能代表整个像素时（即主曲面采样不足时），着色会产生错误。无论这些点是通过光线追踪还是光栅化渲染，各种着色算法都会有走样现象。一些“基于点”的渲染器实际上也是通过光线追踪或光栅化来渲染的。一些解析型渲染器，如空间和时间的完美光束跟踪，可以避免光线采样（不足）问题，但尽管有一些针对特定情况的分析解决方案 [1]，来自射线或栅格交点的点采样仍然是有效渲染复杂物体、材质和光照的唯一开发方法。

由于采样不足而导致的走样表现为锯齿状边缘、空间噪声和闪烁（时间噪声）。一些方法试图使用范围更大、更复杂的重建滤波器（形态学抗锯齿（MLAA）、快速近似抗锯齿（FXAA）、子像素增强抗锯齿（SMAA））将这些走样现象转化为（空间上）模糊或（时间上）残影来掩盖走样现象。在图像中每个像素采样数量固定时，唯一真正的解决走样的方法是增加采样密度并限制采样信号的带宽。增加采样密度效果较好但消耗大，超采样抗锯齿 （SSAA） 的消耗与样本数量成正比，而质量的提高倍数仅为采样数量的平方根。多采样 （MSAA）包括覆盖采样 （CSAA）、基于表面的 （SBAA） [24] 和子像素重建 （SRAA） [4]等方法，这些方法以不同速率采样物体、材质和进行着色，以降低消耗，但同时也会降低质量。聚合（分离覆盖率（DCAA）[25]，聚合几何缓冲（AGAA）[7]）更激进地降低消耗，但仍然限制了实际速率下图像质量。对于带宽受限的场景，通过多级纹理及其变体进行材质预过滤[19]，几何细节级别和着色细节级别减少了采样不足的失真，但引入了一些其他的问题，如过度模糊或突变（时态和空间不连续性），同时使渲染系统复杂化，并且无法完全解决问题。

实时渲染的一般方法是同时使用这些策略中的多种，重点是利用时态抗锯齿。尽管在许多情况下取得了成功，但这些针对特定游戏的解决方案需要非常大的工程复杂性，并且需要对场景进行手动微调[20， 21]。由于所有这些解决方案都依赖于固定的每像素采样数量，因此采样位置之间的材质、物体或着色特征都可能产生错误。最近，Holländer 等人[10]使用高分辨率处理物体并进行粗糙着色来进行抗锯齿处理，并实现了与 SSAA 几乎相同的效果。但这种基于光栅化的方法需要以高分辨率处理所有几何体，即使仅需对几个像素来进行抗锯齿处理。尽管将成片样本数量减少了一半，但每帧消耗的时间的仅减少了小于10%。因此，抗锯齿仍是实时渲染中一个有待解决的问题。

本章描述了一种新的较实用的算法，自适应时间性抗锯齿（ATAA）。该方法通过自适应光线跟踪超采样扩展光栅化渲染的时间抗锯齿来处理锯齿问题。离线光线追踪渲染器长期以来一直使用高度自适应的采样数量来消除锯齿（例如，Whitted 最初的论文 [26]），但现在，由于光追和光栅化在API和硬件架构上的数据可以复用，在实时渲染中使用混合光线追踪和光栅化的方法开始变得可行。最近引入的 DirectX 光线跟踪 API （DXR） 和 NVIDIA RTX 平台实现了整个游戏引擎中 GPU 上两种渲染类型的数据结构和着色器之间的完全互操作性。最关键的是，RTX 通过在 NVIDIA 图灵 GPU 架构上提供包围盒层次结构 （BVH） 遍历和三角形求交任务的硬件加速，显著地提高了光线跟踪性能。因此，本文基于自适应采样的思想，展示了如何有效地将最先进的时间性抗锯齿方法与由 GPU 光线跟踪生态系统的最新发展所出现的混合渲染方法相结合。如表22-1中所示，本文的方法符合商业渲染引擎的约束，消除了标准时间性抗锯齿的模糊和重影现象，并可以在现代图形设备上，每帧16ms的时间限制内，实现接近16倍超级采样的图像质量。本文介绍了工作的一些细节流程，包括将 ATAA 集成到加入 DirectX 光线跟踪支持的原版虚幻引擎 4 （UE4） 中，调整光线追踪样本的自适应分布，尝试射线工作负载压缩优化，和理解 NVIDIA 图灵 GPU 上的光线跟踪性能。